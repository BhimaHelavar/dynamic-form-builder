<div class="form-preview">
  <form [formGroup]="formGroup" (ngSubmit)="onSubmit()">
    <h2>{{ template?.name }}</h2>
    @if (template?.description) {
      <p>{{ template?.description }}</p>
    }
    
    @for (field of template?.fields; track field.id) {
      <div class="field-container">
        @switch (field.type) {
          @case ('text') {
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>{{ field.label }}</mat-label>
              <input matInput [formControlName]="field.id" [placeholder]="field.placeholder || ''" />
              @if (field.helpText) {
                <mat-hint>{{ field.helpText }}</mat-hint>
              }
              @if (formGroup.get(field.id)?.invalid) {
                <mat-error>
                  {{ getErrorMessage(field.id) }}
                </mat-error>
              }
            </mat-form-field>
          }
          
          @case ('textarea') {
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>{{ field.label }}</mat-label>
              <textarea matInput [formControlName]="field.id" [placeholder]="field.placeholder || ''" 
                [rows]="field.config?.rows || 3"></textarea>
              @if (field.helpText) {
                <mat-hint>{{ field.helpText }}</mat-hint>
              }
              @if (formGroup.get(field.id)?.invalid) {
                <mat-error>
                  {{ getErrorMessage(field.id) }}
                </mat-error>
              }
            </mat-form-field>
          }
          

          
          @case ('select') {
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>{{ field.label }}</mat-label>
              <mat-select [formControlName]="field.id" [multiple]="field.config?.multiple">
                @for (option of field.config?.options; track option.value) {
                  <mat-option [value]="option.value">
                    {{ option.label }}
                  </mat-option>
                }
              </mat-select>
              @if (field.helpText) {
                <mat-hint>{{ field.helpText }}</mat-hint>
              }
              @if (formGroup.get(field.id)?.invalid) {
                <mat-error>
                  {{ getErrorMessage(field.id) }}
                </mat-error>
              }
            </mat-form-field>
          }
          
          @case ('checkbox') {
            <div class="checkbox-field">
              <mat-checkbox [formControlName]="field.id">{{ field.label }}</mat-checkbox>
              @if (field.helpText) {
                <mat-hint>{{ field.helpText }}</mat-hint>
              }
            </div>
          }
          
          @case ('radio') {
            <div class="radio-field">
              <label class="radio-group-label">{{ field.label }}</label>
              <mat-radio-group [formControlName]="field.id" class="radio-group">
                @for (option of field.config?.options; track option.value) {
                  <mat-radio-button [value]="option.value">
                    {{ option.label }}
                  </mat-radio-button>
                }
              </mat-radio-group>
              @if (field.helpText) {
                <mat-hint>{{ field.helpText }}</mat-hint>
              }
              @if (formGroup.get(field.id)?.invalid) {
                <mat-error>
                  {{ getErrorMessage(field.id) }}
                </mat-error>
              }
            </div>
          }
          
          @case ('date') {
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>{{ field.label }}</mat-label>
              <input matInput [matDatepicker]="picker" [formControlName]="field.id">
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
              @if (field.helpText) {
                <mat-hint>{{ field.helpText }}</mat-hint>
              }
              @if (formGroup.get(field.id)?.invalid) {
                <mat-error>
                  {{ getErrorMessage(field.id) }}
                </mat-error>
              }
            </mat-form-field>
          }

          @case ('toggle') {
            <div class="toggle-field">
              <mat-slide-toggle [formControlName]="field.id">{{ field.label }}</mat-slide-toggle>
              @if (field.helpText) {
                <mat-hint>{{ field.helpText }}</mat-hint>
              }
            </div>
          }
        }
      </div>
    }
    
    <div class="form-actions">
      <button mat-raised-button color="primary" type="submit" [disabled]="!isEditable || formGroup.invalid">
        <mat-icon>send</mat-icon>
        {{ submitButtonText }}
      </button>
      <button mat-button type="button" (click)="onCancel()">
        <mat-icon>close</mat-icon>
        Cancel
      </button>
    </div>
  </form>
</div>
